interactions:
- request:
    body: null
    headers:
      Authorization:
      - Bearer VIiQwPXd3YdxtAzkjl1S7rUUxaQh9PMy
      User-Agent:
      - DroneCI Butler v0.1.0
    method: GET
    uri: https://drone.dv.nyt.net/api/repos/nytm/wf-project-vi/builds/137019
  response:
    body:
      string: "{\"id\":1108017,\"repo_id\":117,\"trigger\":\"@hook\",\"number\":137019,\"status\":\"failure\",\"event\":\"pull_request\",\"action\":\"synchronized\",\"link\":\"https://github.com/nytm/wf-project-vi/pull/13355\",\"timestamp\":0,\"title\":\"Jest
        + Puppeteer PoC: Revamping E2E tests\",\"message\":\"## TL;DR\\r\\n- **We
        are replatforming e2e tests.** And calling them acceptance tests.\\r\\n- **We
        are using Jest as a test runner, and Puppeteer as the browser controller.**\\r\\n-
        **We created  `puppet-theater \U0001F3AD` under `tools/puppet-theater` to
        stitch Jest and Puppeteer together.**\\r\\n- **We created custom matchers
        with good error messages and developer experience.**\\r\\n- **We are co-locating
        all acceptance tests along with the \\\"system under test\\\".** Same as we
        do for unit tests. That means no more `e2e/` folder.\\r\\n- **Acceptance tests
        feels native to VI**. No additional `yarn install`, no additional `package.json`.\\r\\n\\r\\n##
        Problem\\r\\n\\r\\nOur e2e tests have been flaky and hard to debug, mostly
        due to:\\r\\n\\r\\n- **Complexity of the previous stack.**\\r\\n- **Tests
        used to live on the suburbs of VI on the `e2e/` folder**, instead of having
        the tests co-located with the source code, reducing ownership and visibility
        for that kind of test.\\r\\n- **A different set of technologies, instead of
        using the tooling engineers are already familiar with.**\\r\\n- **Different
        pipelines local and on CI, creating platform-specific bugs that were hard
        to debug.**\\r\\n\\r\\n## Solution\\r\\n\\r\\nOur approach for tackling the
        problem was to have an acceptance test that:\\r\\n- **Uses tools engineers
        are already familiar with.** \\r\\n- **Uses the same pipeline locally and
        on CI.** In order to reduce complexity and to improve reliability.\\r\\n-
        **No additional installation step.** Less friction for developers.\\r\\n-
        **Has a great developer experience.** \\r\\n\\r\\n## API\\r\\n\\r\\nWe are
        exposing on the global scope the [`browser`](https://github.com/puppeteer/puppeteer/blob/main/docs/api.md#class-browser)
        and [`page`](https://github.com/puppeteer/puppeteer/blob/main/docs/api.md#class-page)
        Puppeteer's object, and also adding some helpers methods to facilitate testing
        within our use case.\\r\\n\\r\\n### Additional globals\\r\\n\\r\\n#### `global.page`\\r\\n\\r\\n-
        `global.page.debug()`\\r\\n- `global.page.goToNytUrl()`\\r\\n- `global.page.emulateDevice(deviceType)`\\r\\n-
        `global.page.scrollToSelect\",\"before\":\"87faaf6708d0d099a33bcccda585fa803864c3e5\",\"after\":\"5090ad8f62dadcf5fbdcdcf22daa48e0d1b31664\",\"ref\":\"refs/pull/13355/head\",\"source_repo\":\"nytm/wf-project-vi\",\"source\":\"deprecate-e2e-and-introduce-acceptance-tests\",\"target\":\"main\",\"author_login\":\"gabrielfalcao\",\"author_name\":\"\",\"author_email\":\"\",\"author_avatar\":\"https://avatars.githubusercontent.com/u/54914?v=4\",\"sender\":\"caiogondim\",\"started\":1620787232,\"finished\":1620788167,\"created\":1620787232,\"updated\":1620787232,\"version\":3,\"stages\":[{\"id\":5200770,\"repo_id\":117,\"build_id\":1108017,\"number\":1,\"name\":\"test\",\"kind\":\"pipeline\",\"type\":\"docker\",\"status\":\"success\",\"errignore\":false,\"exit_code\":0,\"machine\":\"agent_prd-1_i-04c70479dc748ae81\",\"os\":\"linux\",\"arch\":\"amd64\",\"started\":1620787232,\"stopped\":1620787481,\"created\":1620787232,\"updated\":1620787481,\"version\":4,\"on_success\":true,\"on_failure\":false,\"labels\":{\"poolhash\":\"agentpool-2-3a513e6792fd9b3d\"},\"steps\":[{\"id\":7758595,\"step_id\":5200770,\"number\":1,\"name\":\"clone\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787232,\"stopped\":1620787262,\"version\":4},{\"id\":7758597,\"step_id\":5200770,\"number\":2,\"name\":\"validate_branch_name_from_pr\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787262,\"stopped\":1620787263,\"version\":4},{\"id\":7758599,\"step_id\":5200770,\"number\":3,\"name\":\"validate_drone_configs_in_sync\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787262,\"stopped\":1620787264,\"version\":4},{\"id\":7758601,\"step_id\":5200770,\"number\":4,\"name\":\"drone_jsonnet_unit_tests\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787262,\"stopped\":1620787264,\"version\":4},{\"id\":7758603,\"step_id\":5200770,\"number\":5,\"name\":\"node_modules\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787264,\"stopped\":1620787348,\"version\":4},{\"id\":7758605,\"step_id\":5200770,\"number\":6,\"name\":\"validate_docs_prettified\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787348,\"stopped\":1620787353,\"version\":4},{\"id\":7758607,\"step_id\":5200770,\"number\":7,\"name\":\"lint_pr\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787348,\"stopped\":1620787378,\"version\":4},{\"id\":7758609,\"step_id\":5200770,\"number\":8,\"name\":\"lint_queries_pr\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787378,\"stopped\":1620787418,\"version\":4},{\"id\":7758611,\"step_id\":5200770,\"number\":9,\"name\":\"test_pr\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787418,\"stopped\":1620787481,\"version\":4}]},{\"id\":5200771,\"repo_id\":117,\"build_id\":1108017,\"number\":2,\"name\":\"build\",\"kind\":\"pipeline\",\"type\":\"docker\",\"status\":\"success\",\"errignore\":false,\"exit_code\":0,\"machine\":\"agent_prd-1_i-0d7cf852315865a34\",\"os\":\"linux\",\"arch\":\"amd64\",\"started\":1620787232,\"stopped\":1620787862,\"created\":1620787232,\"updated\":1620787862,\"version\":4,\"on_success\":true,\"on_failure\":false,\"labels\":{\"poolhash\":\"agentpool-2-3a513e6792fd9b3d\"},\"steps\":[{\"id\":7758591,\"step_id\":5200771,\"number\":1,\"name\":\"clone\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787233,\"stopped\":1620787262,\"version\":4},{\"id\":7758592,\"step_id\":5200771,\"number\":2,\"name\":\"validate_branch_name_from_pr\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787263,\"stopped\":1620787264,\"version\":4},{\"id\":7758593,\"step_id\":5200771,\"number\":3,\"name\":\"validate_drone_configs_in_sync\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787263,\"stopped\":1620787264,\"version\":4},{\"id\":7758594,\"step_id\":5200771,\"number\":4,\"name\":\"node_modules\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787264,\"stopped\":1620787346,\"version\":4},{\"id\":7758596,\"step_id\":5200771,\"number\":5,\"name\":\"build_app\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787346,\"stopped\":1620787589,\"version\":4},{\"id\":7758598,\"step_id\":5200771,\"number\":6,\"name\":\"bundlesize_pr\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787589,\"stopped\":1620787593,\"version\":4},{\"id\":7758600,\"step_id\":5200771,\"number\":7,\"name\":\"sanity_check_pr\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787593,\"stopped\":1620787605,\"version\":4},{\"id\":7758602,\"step_id\":5200771,\"number\":8,\"name\":\"gcs_vi_assets\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787605,\"stopped\":1620787608,\"version\":4},{\"id\":7758604,\"step_id\":5200771,\"number\":9,\"name\":\"gcr\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787605,\"stopped\":1620787862,\"version\":4},{\"id\":7758606,\"step_id\":5200771,\"number\":10,\"name\":\"acceptance_tests_gcr\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787605,\"stopped\":1620787862,\"version\":4},{\"id\":7758608,\"step_id\":5200771,\"number\":11,\"name\":\"build_mocker_vi_image\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787605,\"stopped\":1620787661,\"version\":4},{\"id\":7758610,\"step_id\":5200771,\"number\":12,\"name\":\"sentry_create_release\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787605,\"stopped\":1620787612,\"version\":4}]},{\"id\":5200772,\"repo_id\":117,\"build_id\":1108017,\"number\":3,\"name\":\"acceptance_tests\",\"kind\":\"pipeline\",\"type\":\"docker\",\"status\":\"failure\",\"errignore\":false,\"exit_code\":0,\"machine\":\"agent_prd-1_i-0221a4e49b425cce9\",\"os\":\"linux\",\"arch\":\"amd64\",\"started\":1620787862,\"stopped\":1620788054,\"created\":1620787232,\"updated\":1620788054,\"version\":5,\"on_success\":true,\"on_failure\":false,\"depends_on\":[\"build\"],\"labels\":{\"poolhash\":\"agentpool-2-3a513e6792fd9b3d\"},\"steps\":[{\"id\":7758636,\"step_id\":5200772,\"number\":1,\"name\":\"clone\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787862,\"stopped\":1620787893,\"version\":4},{\"id\":7758637,\"step_id\":5200772,\"number\":2,\"name\":\"samizdat_mock\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787893,\"stopped\":1620788054,\"version\":3},{\"id\":7758638,\"step_id\":5200772,\"number\":3,\"name\":\"abra_mock\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787893,\"stopped\":1620788054,\"version\":3},{\"id\":7758639,\"step_id\":5200772,\"number\":4,\"name\":\"meter_mock\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787893,\"stopped\":1620788054,\"version\":3},{\"id\":7758640,\"step_id\":5200772,\"number\":5,\"name\":\"acceptance_tests_install\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787893,\"stopped\":1620787965,\"version\":4},{\"id\":7758641,\"step_id\":5200772,\"number\":6,\"name\":\"vi.nytimes.com\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787894,\"stopped\":1620788054,\"version\":3},{\"id\":7758642,\"step_id\":5200772,\"number\":7,\"name\":\"acceptance_tests_wait_for_servers_to_be_ready\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787894,\"stopped\":1620787969,\"version\":4},{\"id\":7758644,\"step_id\":5200772,\"number\":8,\"name\":\"acceptance_tests_http_status_check\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787970,\"stopped\":1620788034,\"version\":4},{\"id\":7758646,\"step_id\":5200772,\"number\":9,\"name\":\"acceptance_tests_test_smartphone\",\"status\":\"failure\",\"exit_code\":1,\"started\":1620788034,\"stopped\":1620788037,\"version\":4},{\"id\":7758648,\"step_id\":5200772,\"number\":10,\"name\":\"acceptance_tests_test_tablet\",\"status\":\"failure\",\"exit_code\":1,\"started\":1620788034,\"stopped\":1620788037,\"version\":4},{\"id\":7758650,\"step_id\":5200772,\"number\":11,\"name\":\"acceptance_tests_test_desktop\",\"status\":\"success\",\"exit_code\":0,\"started\":1620788034,\"stopped\":1620788054,\"version\":4}]},{\"id\":5200773,\"repo_id\":117,\"build_id\":1108017,\"number\":4,\"name\":\"performance_test\",\"kind\":\"pipeline\",\"type\":\"docker\",\"status\":\"success\",\"errignore\":false,\"exit_code\":0,\"machine\":\"agent_prd-1_i-0a6f76b77004da63e\",\"os\":\"linux\",\"arch\":\"amd64\",\"started\":1620787862,\"stopped\":1620788167,\"created\":1620787232,\"updated\":1620788167,\"version\":5,\"on_success\":true,\"on_failure\":false,\"depends_on\":[\"build\"],\"steps\":[{\"id\":7758643,\"step_id\":5200773,\"number\":1,\"name\":\"clone\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787862,\"stopped\":1620787893,\"version\":4},{\"id\":7758645,\"step_id\":5200773,\"number\":2,\"name\":\"samizdat_mock\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787893,\"stopped\":1620788167,\"version\":3},{\"id\":7758647,\"step_id\":5200773,\"number\":3,\"name\":\"abra_mock\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787893,\"stopped\":1620788167,\"version\":3},{\"id\":7758649,\"step_id\":5200773,\"number\":4,\"name\":\"meter_mock\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787893,\"stopped\":1620788167,\"version\":3},{\"id\":7758651,\"step_id\":5200773,\"number\":5,\"name\":\"vi.nytimes.com\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787894,\"stopped\":1620788167,\"version\":3},{\"id\":7758652,\"step_id\":5200773,\"number\":6,\"name\":\"acceptance_tests_wait_for_servers_to_be_ready\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787894,\"stopped\":1620787937,\"version\":4},{\"id\":7758653,\"step_id\":5200773,\"number\":7,\"name\":\"performance_test_live_blog\",\"status\":\"success\",\"errignore\":true,\"exit_code\":0,\"started\":1620787937,\"stopped\":1620788115,\"version\":4},{\"id\":7758654,\"step_id\":5200773,\"number\":8,\"name\":\"performance_test_story_audio_header\",\"status\":\"success\",\"errignore\":true,\"exit_code\":0,\"started\":1620787937,\"stopped\":1620788087,\"version\":4},{\"id\":7758656,\"step_id\":5200773,\"number\":9,\"name\":\"performance_test_story_run_of_the_mill\",\"status\":\"success\",\"errignore\":true,\"exit_code\":0,\"started\":1620787937,\"stopped\":1620788084,\"version\":4},{\"id\":7758658,\"step_id\":5200773,\"number\":10,\"name\":\"performance_test_story_run_of_the_mill_with_3p\",\"status\":\"success\",\"errignore\":true,\"exit_code\":0,\"started\":1620787937,\"stopped\":1620788097,\"version\":4},{\"id\":7758659,\"step_id\":5200773,\"number\":11,\"name\":\"performance_test_story_full_bleed_vertical\",\"status\":\"success\",\"errignore\":true,\"exit_code\":0,\"started\":1620787937,\"stopped\":1620788099,\"version\":4},{\"id\":7758660,\"step_id\":5200773,\"number\":12,\"name\":\"performance_test_story_video_in_header\",\"status\":\"success\",\"errignore\":true,\"exit_code\":0,\"started\":1620787937,\"stopped\":1620788084,\"version\":4},{\"id\":7758661,\"step_id\":5200773,\"number\":13,\"name\":\"performance_test_story_opinion_translated_big_lead\",\"status\":\"success\",\"errignore\":true,\"exit_code\":0,\"started\":1620787937,\"stopped\":1620788087,\"version\":4},{\"id\":7758662,\"step_id\":5200773,\"number\":14,\"name\":\"performance_test_story_opinion_translated_big_lead_gateway_loaded\",\"status\":\"success\",\"errignore\":true,\"exit_code\":0,\"started\":1620787937,\"stopped\":1620788095,\"version\":4},{\"id\":7758663,\"step_id\":5200773,\"number\":15,\"name\":\"perf_metrics\",\"status\":\"success\",\"exit_code\":0,\"started\":1620788115,\"stopped\":1620788167,\"version\":4}]},{\"id\":5200774,\"repo_id\":117,\"build_id\":1108017,\"number\":5,\"name\":\"pre_deployment_check\",\"kind\":\"pipeline\",\"type\":\"docker\",\"status\":\"success\",\"errignore\":false,\"exit_code\":0,\"machine\":\"agent_prd-1_i-0238b008c466dcf4a\",\"os\":\"linux\",\"arch\":\"amd64\",\"started\":1620787862,\"stopped\":1620787906,\"created\":1620787232,\"updated\":1620787906,\"version\":5,\"on_success\":true,\"on_failure\":false,\"depends_on\":[\"build\"],\"labels\":{\"poolhash\":\"agentpool-2-3a513e6792fd9b3d\"},\"steps\":[{\"id\":7758655,\"step_id\":5200774,\"number\":1,\"name\":\"clone\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787862,\"stopped\":1620787893,\"version\":4},{\"id\":7758657,\"step_id\":5200774,\"number\":2,\"name\":\"check_image_pre_prod_gcr\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787893,\"stopped\":1620787906,\"version\":4}]},{\"id\":5200775,\"repo_id\":117,\"build_id\":1108017,\"number\":6,\"name\":\"deployment\",\"kind\":\"pipeline\",\"type\":\"docker\",\"status\":\"success\",\"errignore\":false,\"exit_code\":0,\"machine\":\"agent_prd-1_i-04c70479dc748ae81\",\"os\":\"linux\",\"arch\":\"amd64\",\"started\":1620787906,\"stopped\":1620788066,\"created\":1620787232,\"updated\":1620788066,\"version\":5,\"on_success\":true,\"on_failure\":false,\"depends_on\":[\"build\",\"test\",\"pre_deployment_check\"],\"labels\":{\"poolhash\":\"agentpool-2-3a513e6792fd9b3d\"},\"steps\":[{\"id\":7758664,\"step_id\":5200775,\"number\":1,\"name\":\"clone\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787906,\"stopped\":1620787936,\"version\":4},{\"id\":7758665,\"step_id\":5200775,\"number\":2,\"name\":\"gke_preview_envs_main_dev_east_pr\",\"status\":\"success\",\"exit_code\":0,\"started\":1620787936,\"stopped\":1620788063,\"version\":4},{\"id\":7758666,\"step_id\":5200775,\"number\":3,\"name\":\"sentry_create_deploy_deprecate-e2e-and-introduce-acceptance-tests-sbx_pr\",\"status\":\"success\",\"exit_code\":0,\"started\":1620788063,\"stopped\":1620788066,\"version\":4},{\"id\":7758667,\"step_id\":5200775,\"number\":4,\"name\":\"slack_blame_pr\",\"status\":\"success\",\"exit_code\":0,\"started\":1620788063,\"stopped\":1620788065,\"version\":4},{\"id\":7758668,\"step_id\":5200775,\"number\":5,\"name\":\"slack_blame_deploy_preview_pr\",\"status\":\"success\",\"exit_code\":0,\"started\":1620788063,\"stopped\":1620788064,\"version\":4}]},{\"id\":5200776,\"repo_id\":117,\"build_id\":1108017,\"number\":7,\"name\":\"post_deployment_check\",\"kind\":\"pipeline\",\"type\":\"docker\",\"status\":\"skipped\",\"errignore\":false,\"exit_code\":0,\"os\":\"linux\",\"arch\":\"amd64\",\"started\":1620788066,\"stopped\":1620788066,\"created\":1620787232,\"updated\":1620787232,\"version\":2,\"on_success\":true,\"on_failure\":false,\"depends_on\":[\"deployment\"],\"labels\":{\"poolhash\":\"agentpool-2-3a513e6792fd9b3d\"}},{\"id\":5200777,\"repo_id\":117,\"build_id\":1108017,\"number\":8,\"name\":\"metrics\",\"kind\":\"pipeline\",\"type\":\"docker\",\"status\":\"success\",\"errignore\":false,\"exit_code\":0,\"machine\":\"agent_prd-1_i-096c4f420f08b61e4\",\"os\":\"linux\",\"arch\":\"amd64\",\"started\":1620788066,\"stopped\":1620788149,\"created\":1620787232,\"updated\":1620788149,\"version\":5,\"on_success\":true,\"on_failure\":true,\"depends_on\":[\"test\",\"pre_deployment_check\",\"acceptance_tests\",\"build\",\"deployment\"],\"labels\":{\"poolhash\":\"agentpool-2-3a513e6792fd9b3d\"},\"steps\":[{\"id\":7758669,\"step_id\":5200777,\"number\":1,\"name\":\"clone\",\"status\":\"success\",\"exit_code\":0,\"started\":1620788066,\"stopped\":1620788096,\"version\":4},{\"id\":7758670,\"step_id\":5200777,\"number\":2,\"name\":\"general_metrics\",\"status\":\"success\",\"exit_code\":0,\"started\":1620788096,\"stopped\":1620788149,\"version\":4}]}]}\n"
    headers:
      Cache-Control:
      - no-cache, no-store, must-revalidate, private, max-age=0
      Connection:
      - keep-alive
      Content-Type:
      - application/json
      Date:
      - Mon, 31 May 2021 18:55:58 GMT
      Expires:
      - Thu, 01 Jan 1970 00:00:00 UTC
      Pragma:
      - no-cache
      Transfer-Encoding:
      - chunked
      Vary:
      - Origin
      X-Accel-Expires:
      - '0'
    status:
      code: 200
      message: OK
version: 1
