rulesets:
  wf-project-vi:
    default-conditions:
      - build.link:
          contains_string: "nytm/wf-project-vi"
      - step.status: failed
      - step.exit_code:
          is_not:  0

    default_action: NEXT_RULE # default to continue analysis onto next step after matching a rule
    default_notify:
      - slack

    rules:
      - name: ValidateDocsPrettified
        when:
          - step.output:
              matches_regex: "prettier:docs"
        action: NEXT_RULE

      - name: SlackServerError
        when:
          - step.name:
              contains_string: "slack"
          - step.output:
              contains_string: "server error"
        action: NEXT_RULE

      # skip build (and cancel it if still running)
      - name: GitBranchNameInvalidForGKEDeploy
        when:
          - step.output:
              matches_regex: "prettier:docs"
        action: SKIP_ANALYSIS

      - name: GitMergeConflict
        when:
          - step.output:
              matches_regex: "(not something we can merge|Automatic merge failed; fix conflicts)"

        action: SKIP_ANALYSIS

      - name: SamizdatConnectionError
        when:
          - step.output:
              contains_string:
                - "ECONNREFUSED"
                - "samizdat"
        action: SKIP_ANALYSIS
        notify:
          - slack
          - github

      - name: YarnDependencyNotResolved
        when:
          - step.name:
              contains_string: "node_modules"
          - step.output:
              contains_string: "Couldn't find any versions for"

        action: SKIP_ANALYSIS
        notify:
          - slack
          - github

auth:
  jwt_secret: "$2b$16$Uvv2.9G1aKPzkWylmSFWbu"
  flask_secret: ".8SCrZE71zhiUtZJhGcGJj$21$b2$"

sqlalchemy:
  uri: "postgresql://drone_ci_butler:drone_ci_butler@postgres/drone_ci_butler"

github:
  oauth_client:
    # this is the github oauth app https://github.com/settings/applications/1641444
    client_id: "97544d4569b6a9e7593a"
    client_secret: "6bf930ff09ee5952f1fc837365df6d9db426a593"

  app:
    webhook_secret: "$2b$16$/AHK3MCrtJ35m9uEAVdWue"
    app_id: "119580"
    client_id: "iv1.9aecc13341778206"
    client_secret: "1018f68309e66e603856808210687f38caa449e9"
    secret_key: |
        -----BEGIN RSA PRIVATE KEY-----
        MIIEpAIBAAKCAQEAu4IacLeAg2FJnkB+hSnEqv3RMAZHO94yIAFZ2Ourw3eYe4Y4
        AZclXCW/yIMUI2HFnggSq2LtwrDTojTsReYMG2S3ORHSdqz6WmC7I0D2nukAmNyg
        L70qZ+8Yi42FuViNkWDnDib40jX4kGfjWC/LOlmgpC94jEnQ25BhxTGwgXvNKw64
        Qx0RgTu/95DS0/s1WCV/ymbfpjM1JWusRpCRoinpFVSOFZK1B+GD99hSkdhW0age
        3wAwPvuT00lz6kd3sNEU2Wr5mhLBdH9780k2b5+/bVYgzZ/2Edymmpi1o9eGA6mr
        +abk7IR3wggIckASBxitCe9eIsBlXX9lzha3/QIDAQABAoIBAQCWqD14TWh7p0KQ
        XX+KnPnA7bkTXigECU66+nrnWMwkfMZOkZQUaw4AkPAcOn2GxDsU86WUgSNKJ+uT
        S/R/YQxfQjgZKaGx6uAol8ok1ECTg+EP8Uzfrp0Q70IIdsh4GJd+tJ5Rd6y6sdSq
        ql43cAdZNcRlxyKTjYe7srFr0LXiAmeyBpDbT7/EZNQC0Dqyo8+A6U0GLUCBA9/b
        QfTTda/8teTeedCLW+WKjOFcsCe4pregGTXwLSM6zDVet5olMoJrpsc2XiEQs7gh
        0ILOdYid8eTZgMC6UnX+op0jOLZzhu8Xy7k1H1FLk8ACvfXATwZmVOoT8vsIcXjX
        2pgP6yNdAoGBAOCrmhhlF4a4gmhjBmaoQ9bU0LH+HkWdTFkkm7TcOSRdxYy/k/bD
        +eyqwJcdcXoW1xGBma296384i1EAsrsG69jfWMXJkXSH7TElAksxwIxX0Lg9VYyo
        zkobwRBIwjjVzFLgVz1V0oj91i8WZgP/n3OaoTscJ9ySu9jP3Z6pjpmbAoGBANWn
        3oRF7ANhqy2bQiMTk2HunoCCjiit4BA8ckC7YL1U7pRZYDLy96xBo4dvshjegFub
        8VcCszLmTkR9kryAVSRD0yPF5v1FbHKI/84w5eabx9a0hyhmR77ATQgCnPOS551D
        qGGdyLBp7aXU9kC4oaVkwSVLlud9aiV9UGnohzpHAoGAHUef7H/4QfF35VzKb8SM
        GspfbGL+1Pm8An4X4Mk2lTu3TDGHeghuYN6b/NW0fUHOw5RNT+xJbaoT1fmuUVuE
        jx4EdrpfP32bduUo2F3ihyfGpswvgwZY5CWb0qB412ldmItuMyslJf9W04oqv2io
        AivryUVRGJjy7D2i11OnpvMCgYEAiLBFI8q4G9G4eg0CWv6DI/xNW1orKMtUtg51
        6gP2+CoGGNK1QONAoOu9e0ByaIaxB+rUlB4eF0pQeHD+F6rizbi2tARAq3hm0T/k
        qD2QV+ECENKeRbJp5BeTMLS7RPmPRIWsjAcuBe8/IwEEKpP0lqPHDd02RhNufV2W
        vKsPGLECgYAnHrz1WPdenwZkfpb1Eu0BCOpNKD/S7WqoWroxYK+SXiH/LZr3DYts
        GGQzlo7PA79iS+m/bOns28AAmYtF/HF8GQBDTmE4Qb7m6ixX/dCSzEwjpAzul8J1
        30emGEfyNJH3/RddHH2+rU8IHIp2/eei7cpQszKxAOvrwi8IhO0iBQ==
        -----END RSA PRIVATE KEY-----

slack:
  store:
    state_path: .drone-butler-slack/state
    installation_path: .drone-butler-slack/installation

  oauth:
    app_id: "A024G7M2WKG"
    app_user_token: "xoxp-2177882080-1414377123169-2156427356501-572349e9838ff24c8da066dda8113073"
    bot_token: "xoxb-2177882080-2152268657686-HY3j6ebq1TSxSF6T8eAtFiFT"
    client_id: "2177882080.2152259098662"
    client_secret: "17692091b32dc58cd5c46a3f4e6427ef"
    signing_secret: "baa3d55eac936cacb7e407b6911179d8"
    verification_token: "Lu4StefWmfS2DuUaDTb9sqyl"

drone:
  server: "https://drone.dv.nyt.net"
  access_token: "VIiQwPXd3YdxtAzkjl1S7rUUxaQh9PMy"
  api:
    owner: nytm
    repo: wf-project-vi
    max_builds: 139275
    max_pages: 5571
    # max_builds: 139275
    # max_pages: 10
    initial_page: 0

session:
  type: "redis"
  # type: "filesystem"
  file_dir: /tmp/flask-session


web:
  host: 0.0.0.0
  port: 4000

workers:
  queue_rep_address: tcp://butler_workers:5555
  queue_pull_address: tcp://butler_workers:5556
  push_address: tcp://butler_workers:6666
  pull_address: tcp://butler_workers:7777
  monitor_address: tcp://butler_workers:5001
  control_address: tcp://butler_workers:5002
  # max_per_process: 17

elasticsearch:
  host: elasticsearch
  port: 9200

postgres:
  host: postgres
  port: 5432
  user: drone_ci_butler
  password: drone_ci_butler
  db: drone_ci_butler

redis:
  host: redis
  port: 6379
  db: 0

logging:
  default_level: DEBUG
  mapping:
    elasticsearch: WARNING
    redis: WARNING
    sqlalchemy: WARNING
    urllib3.connectionpool: ERROR
    system.events: WARNING
    parso.python: ERROR
    asyncio: ERROR
